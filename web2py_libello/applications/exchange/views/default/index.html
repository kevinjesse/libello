{{extend 'layout.html'}}

<div id="target"></div>

<script id="libello" type="text/ractive">
<div class="jumbotron trans">
    <h1 align="center"><img src="http://i.imgur.com/kV7GqPP.gif"> Libello</h1>
    <p align="center">
    {{if auth.user_id is None:}}
        {{=A('Sign Up', _class='btn btn-primary', _href=URL('default', 'user', args=['register']))}}
        {{=A('Sign In', _class='btn btn-success', _href=URL('default', 'user', args=['login']))}}
    {{else:}}
        <button class="btn btn-primary" data-toggle="modal" data-target="#insertForm"><i class="fa fa-plus"></i> Add Book</button>
        {{=A('Sign In', _class='btn btn-danger', _href=URL('default', 'user', args=['logout']))}}
    {{pass}}
    </p>
</div>


  <div class="modal fade" id="insertForm" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Sell Book On Libello</h4>
        </div>
        <div class="modal-body">
            <div class="container">
                  <form role="form">
                    <div class="form-group col-xs-3">
                      <label for="title">Title:</label>
                      <input type="text" class="form-control" id="title" placeholder="Book Title">
                    </div>
                    <div class="form-group col-xs-3">
                      <label for="Author">Author:</label>
                      <input type="text" class="form-control" id="author" placeholder="Author">
                    </div>
                    <div class="form-group col-xs-3">
                      <label for="isbn">ISBN:</label>
                      <input type="text" class="form-control" value="{%isbn%}"
                       id="isbn" placeholder="ISBN">
                    </div>
                  </form>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-default" on-click="lookup" >Perform Lookup</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</script>




<script>
    $(function () {
        // Ractive object
        var MAIN = new Ractive({
            el: '#target',
            template: '#libello',
            delimiters: ['{%', '%}'],
            tripleDelimiters: ['{%%', '%%}'],
            data: {
                book_list: [],
                author:"",
                title:"",
                isbn: ""
            }
        });

            // We want to create a new board
        MAIN.on("lookup", function () {

            var isbn = MAIN.get('isbn');
            // if ISBN provided do lookup,
            if (isbn != '') {
                // check if isbn good or fail
                var valid = verify_isbn(isbn);

                // good, do google search by isbn
                // fail do google loookup by author +title
            }else {
                //do google author lookup
            }

            MAIN.set('isbn', '');
            MAIN.set('author', '');
            MAIN.set('title', '');
        });

        // Ajax to send edit content to database
        function verify_isbn(isbn) {
            $.ajax("{{=URL('default', 'verify_isbn', user_signature=True)}}",
                    {
                        async:false,
                        data: {
                            isbn:isbn
                        },
                        method: 'POST',
                        success: function (bool) {
                            alert(bool);
                            return bool
                        },
                        error: function () {
                        }
                    }
            );
        }


    });




</script>




